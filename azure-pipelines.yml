trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'windows-latest'

steps:
- task: NodeTool@0 
  inputs:
    versionSpec: '18.x'  
  displayName: 'Set up Node.js'

- checkout: self
  displayName: 'Checkout Repository'

- script: |
    node -v
    npm -v
  displayName: 'Check Node.js and npm Versions'

- script: |
    npm ci
  displayName: 'Install dependencies'

- script: |
    npm install -D typescript@latest
    npm install -D playwright@latest
    npm install -D @types/node@latest
    npx playwright install-deps
    npx playwright install
  displayName: 'Install Playwright and TypeScript'

- script: |
    npx tsc --noEmit
  displayName: 'Validate TypeScript'

- script: |
    npx tsc 
    export DEBUG=pw:api
    npx playwright test --reporter=json --output=./
  displayName: 'Run Playwright Tests'
  continueOnError: true  

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'test-results.json'
    ArtifactName: 'test-results-json'
  condition: succeededOrFailed()

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: 'screenshots'
    ArtifactName: 'test-screenshots'
  condition: succeededOrFailed()