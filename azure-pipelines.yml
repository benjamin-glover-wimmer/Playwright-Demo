trigger:
  branches:
    include:
      - main

pool:
  vmImage: 'windows-latest'

steps:
- task: NodeTool@0 
  inputs:
    versionSpec: '18.x'  
  displayName: 'Set up Node.js'

- checkout: self
  displayName: 'Checkout Repository'

- script: |
    node -v
    npm -v
  displayName: 'Check Node.js and npm Versions'

- script: |
    npm ci
  displayName: 'Install dependencies'

- script: |
    npm install -D typescript@latest
    npm install -D playwright@latest
    npm install -D @types/node@latest
    npx playwright install-deps
    npx playwright install
  displayName: 'Install Playwright and TypeScript'

- script: |
    npx tsc --noEmit
  displayName: 'Validate TypeScript'

- script: |
    echo "Running Playwright tests..."
    npx playwright test --reporter=json --output=./test-results
    echo "Test results saved to ./test-results"
  displayName: 'Run Playwright Tests'
  continueOnError: true  

- script: |
    echo "Verifying test results..."
    cat ./test-results/test-results.json
  displayName: 'Verify Test Results File'

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: './test-results'
    ArtifactName: 'test-results'
  condition: succeededOrFailed()

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: './screenshots'
    ArtifactName: 'test-screenshots'
  condition: succeededOrFailed()